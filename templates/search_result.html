{% load staticfiles %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src = "{% static 'jquery/jquery.js' %}"></script>
    <script src = "{% static 'jquery/jquery-ui.min.js' %}"></script>
    <script src = "{% static 'bootstrap/js/bootstrap.min.js' %}"></script>

    <script src = "{% static 'js/handlebars-v4.0.10.js' %}"></script>
    <script src = "{% static 'js/typeahead.bundle.js' %}"></script>

    <link href="{% static 'extcss/index.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" media="screen">
    <link href="{% static 'extcss/typeaheadjs.css' %}" rel="stylesheet">
    <title>TDS</title>

    <script>

        function getCookie(name) 
        { 
        var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)"); 
        if(arr=document.cookie.match(reg))
            return unescape(arr[2]); 
        else 
            return null; 
        } 
        $(function () {
        $.ajaxSetup({
            headers: { "X-CSRFToken": getCookie("csrftoken") }
        });
        });

        $(function(){
            console.info("agaga");
                console.info($("#query_content").val());
//                toRed($("#query_content").val());
            });

            function toRed(content){
                var bodyHtml = $("body").html();
                console.info(bodyHtml);
                var x = bodyHtml.replace(new RegExp(content,"gm"),"<font color='red' >"+content+"</font>")
                $("body").html(x);
                console.info(x);
            }



    $(document).ready(function ($) {
    //远程数据源
    var remote_solutions = new Bloodhound({
        datumTokenizer: Bloodhound.tokenizers.obj.whitespace('SolutionName'),
        queryTokenizer: Bloodhound.tokenizers.whitespace,
        remote: {
            url: '/search?solutionName=%QUERY&request=typeaheadData',
            wildcard: '%QUERY'
        }
    });

    remote_solutions.initialize();

    $('#remote-solution .typeahead').typeahead(null, {
        name: 'solutions',
        displayKey: 'SolutionName',
        source: remote_solutions.ttAdapter()
    });
    });


    $(document).ready(function(){
    $("#input_search").keyup(function(event){
        if(event.keyCode ==13){
            var query = $("#input_search").val()
            //跳转到定位页面 ?username=zhangsan
            next_location = '/result/?q='+ query  + '&page=1';
            console.log("执行了按钮"+ next_location);
            location.href= next_location;
         }
    });

    $("#bt_search").click(function(e){
            var query = $("#input_search").val()
            //跳转到定位页面 ?username=zhangsan
            next_location = '/result/?q='+ query  + '&page=1';
            console.log("执行了按钮"+ next_location);
            location.href= next_location;
    });

    });

    </script>

</head>


<body>

    <div class="row" style="margin-top:30px">
            <p id="query_content" hidden="hidden">{{query}}</p>
        <div class="col-lg-1"><img src="/static/images/log.png" width="100px"></div>
        <div class="col-lg-4">
            <div class="input-group" id="remote-solution">
                <input class="form-control typeahead" type="text" id="input_search" value="{{placeholder}}">
                <span class="input-group-addon btn btn-primary" id="bt_search">搜索</span>
            </div>
        </div>
    </div>

    <br>
    <br>


    <div class="col-lg-7 column cmdinfos" id="search_result">
        {% for cmdinfo in cmdinfos %}
        <div class="well searched_mmlinfo">
            <span class="cmdname"><a href="/searchresult/?mml={{cmdinfo.cmdname}}">{{ cmdinfo.cmdname }}    {{ cmdinfo.cmd_func }}</a></span>
            <span class="groupname"><a href="{{cmdinfo.responsefield.introduce}}">{{ cmdinfo.responsefield.groupname }}</a></span>
        </div>
        {% endfor %}

        {% for solution in solutions %}
        <div class="well searched_solution">
            <span class="solution_info"><a href="/searchresult/?solution={{solution.id}}">{{ solution.solutionname }}</a></span>
        </div>
        {% endfor %}

        {% if not cmdinfos and not solutions %}
        <div class="well">
            <span> 没找到和{{query}}相关的结果.</span>
        </div>
        {% endif %}


        {% if cmdinfos or solutions %}
        <ul class="pagination">
            {% if items.has_previous %}
            <li><a href="?q={{placeholder}}&page={{items.previous_page_number}}">«</a></li>
            {% endif %}
            {% for page in page_range %}
            {% if page == items.number %}
            <li class="active"><a href="?q={{placeholder}}&page={{page}}">{{page}}</a></li>
            {% else %}
            <li><a href="?q={{placeholder}}&page={{page}}">{{page}}</a></li>
            {% endif %}
            {% endfor %}
            {% if items.has_next %}
            <li><a href="?q={{placeholder}}&page={{items.next_page_number}}">»</a></li>
            {% endif %}

        </ul>
        {% endif %}

    </div>


</body>


</html>